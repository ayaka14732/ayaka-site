<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-HK" xml:lang="zh-HK" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="三日月綾香" />
  <meta name="keywords" content="簡繁轉換, 字型, 簡轉繁字型, OpenType 特性, GSUB 規則" />
  <title>正確實現簡轉繁字型</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ayaka14732/syyon-vencie@a4c9a00/csslib/pandoc.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ayaka14732/syyon-vencie@de1d7f3/csslib/serif.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!-- Others -->
  <meta property="og:image" content="https://avatars2.githubusercontent.com/u/68557794?s=400&u=343da7bebff676129e87341def71121ebffc4c9c&v=4"/>
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      var xs = document.getElementsByTagName('code');
      for (var i = 0, len = xs.length; i < len; i++)
        xs[i].lang = 'en-x-code';
      xs = document.getElementsByClassName('footnote-back');
      for (var i = 0, len = xs.length; i < len; i++)
        xs[i].lang = 'en-x-code';
      document.querySelectorAll('div.sourceCode > pre').forEach(function(x) {
        x.classList.add('numberSource');
      });
    });
  </script>
  
</head>
<body>
<header id="title-block-header">
<h1 class="title">正確實現簡轉繁字型</h1>
<p class="author">三日月綾香</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#簡介">簡介</a></li>
<li><a href="#一簡對多繁現象">「一簡對多繁」現象</a></li>
<li><a href="#opencc-的簡繁轉換演算法">OpenCC 的簡繁轉換演算法</a></li>
<li><a href="#opentype-字型的-gsub-規則">OpenType 字型的 GSUB 規則</a></li>
<li><a href="#使用-gsub-規則實現簡繁轉換演算法">使用 GSUB 規則實現簡繁轉換演算法</a></li>
<li><a href="#侷限性">侷限性</a>
<ul>
<li><a href="#句子本身存在歧義">句子本身存在歧義</a></li>
<li><a href="#opencc-簡繁轉換演算法的侷限性">OpenCC 簡繁轉換演算法的侷限性</a></li>
<li><a href="#opencc-詞庫的侷限性">OpenCC 詞庫的侷限性</a></li>
<li><a href="#opentype-字型的侷限性">OpenType 字型的侷限性</a></li>
</ul></li>
<li><a href="#功能擴展">功能擴展</a>
<ul>
<li><a href="#opentype-字型的-trad-特性">OpenType 字型的 trad 特性</a></li>
<li><a href="#地區字詞轉換">地區字詞轉換</a></li>
</ul></li>
<li><a href="#字型下載">字型下載</a></li>
</ul>
</nav>
<blockquote>
<p><span lang="zh-CN">简体中文版《<a href="../" hreflang="zh-CN">正确实现简转繁字体</a></span>》，同時發佈於知乎：<a href="https://zhuanlan.zhihu.com/p/166089642" lang="zh-CN" hreflang="zh-CN">正确实现简转繁字体 - 三日月 綾香的文章</a></p>
</blockquote>
<h1 id="簡介">簡介</h1>
<p>簡轉繁字型是將簡體文字以繁體字顯示的字型。對於習慣閲讀繁體字的用户，在某些不提供簡繁轉換的平台（如電子書閲讀裝置），可以利用簡轉繁字型令簡體文字以繁體字顯示，從而減少閲讀時的負擔。</p>
<p><img src="https://raw.githubusercontent.com/ayaka14732/FanWunMing/f0f2f9bd0d8f76a853248ec03e3f54296dc85b80/demo.png" /></p>
<p>然而，現時的簡轉繁字型是簡單地將簡體字的碼位對應繁體字形，不能處理簡體字與繁體字之間存在的「一簡對多繁」現象，因此使用效果並不理想，也使許多人產生了「字型不能正確處理簡轉繁」的錯誤印象。</p>
<p>事實上，目前通行的 OpenType 字型格式提供了大量字型特性。使用其中的 GSUB（glyph substitution，字圖替換）規則，可以實現能處理「一簡對多繁」的簡轉繁字型。</p>
<p>本文介紹了簡繁轉換工具 <a href="https://github.com/BYVoid/OpenCC">OpenCC</a> 與 OpenType 字型的 GSUB 規則，並介紹了將二者結合，在字型層面實現簡繁轉換的方法。利用同一方法，也可以實現能處理破音字的拼音字型及注音字型。</p>
<h1 id="一簡對多繁現象">「一簡對多繁」現象</h1>
<p>「一簡對多繁」是指一個簡體字對應多個繁體字的現象。例如，簡體字「<span lang="zh-CN">后</span>」同時對應「後」（後面）與「后」（太后）兩個繁體字。</p>
<p>由於「一簡對多繁」現象，在簡轉繁時需要考慮上下文。</p>
<h1 id="opencc-的簡繁轉換演算法">OpenCC 的簡繁轉換演算法</h1>
<p>OpenCC 是開放原始碼的中文簡繁轉換工具，可以利用詞語處理「一簡對多繁」現象。</p>
<p>OpenCC 詞庫不僅定義了單字的簡繁對應關係，還定義了數萬個詞語的簡繁對應關係。OpenCC 程式執行時根據「正向最大匹配」演算法匹配文章中的簡體詞語，然後轉換為繁體。</p>
<p>例如，在轉換句子「<span lang="zh-CN">太后的头发很干燥</span>」時，程式根據詞庫中存在的詞語，從左至右依次匹配「<span lang="zh-CN">太后</span>」、「<span lang="zh-CN">的</span>」、「<span lang="zh-CN">头发</span>」、「<span lang="zh-CN">很</span>」、「<span lang="zh-CN">干燥</span>」，然後分別轉換為「太后」、「的」、「頭髮」、「很」、「乾燥」。</p>
<h1 id="opentype-字型的-gsub-規則">OpenType 字型的 GSUB 規則</h1>
<p>OpenType 字型提供了 GSUB 規則，用於替換字型中的字圖。</p>
<p>GSUB 規則可以分為以下六類：</p>
<ol type="1">
<li>single substitution（一對一替換）</li>
<li>ligature substitution（多對一替換）</li>
<li>multiple substitution（一對多替換）</li>
<li>alternate substitution（一對一替換，但提供多種選擇）</li>
<li>chaining contextual substitution（帶上下文的一對一/多對一/一對多替換）</li>
<li>reverse chaining contextual substitution（逆向、帶上下文的一對一替換）</li>
</ol>
<h1 id="使用-gsub-規則實現簡繁轉換演算法">使用 GSUB 規則實現簡繁轉換演算法</h1>
<p>簡繁轉換需要實現多對多替換，例如將「<span lang="zh-CN">错综复杂</span>」轉換為「錯綜複雜」，四個字均發生了變化。然而，以上六種 GSUB 規則僅包括一對一、多對一、一對多替換，卻不包括多對多替換。</p>
<p>為了實現多對多替換，可以採用「偽字圖」的方法。首先使用多對一替換，將簡體詞語替換為一個偽字圖；然後使用一對多替換，將這個偽字圖替換為繁體詞語。</p>
<p>示例如下：</p>
<table>
<tr>
<th>
輸入字串
</th>
<td>
U+97E9
</td>
<td>
U+5267
</td>
<td>
U+5947
</td>
<td>
U+7687
</td>
<td>
U+540E
</td>
<td>
U+64AD
</td>
<td>
U+51FA
</td>
<td>
U+540E
</td>
</tr>
<tr>
<th>
對應簡體字圖
</th>
<td lang="zh-CN">
韩
</td>
<td lang="zh-CN">
剧
</td>
<td lang="zh-CN">
奇
</td>
<td lang="zh-CN">
皇
</td>
<td lang="zh-CN">
后
</td>
<td lang="zh-CN">
播
</td>
<td lang="zh-CN">
出
</td>
<td lang="zh-CN">
后
</td>
</tr>
<tr>
<th>
第一步替換
</th>
<td colspan="2">
偽字圖 0
</td>
<td lang="zh-CN">
奇
</td>
<td colspan="2">
偽字圖 1
</td>
<td colspan="2">
偽字圖 2
</td>
<td lang="zh-CN">
后
</td>
</tr>
<tr>
<th>
第二步替換
</th>
<td colspan="2">
偽字圖 0
</td>
<td>
奇
</td>
<td colspan="2">
偽字圖 1
</td>
<td colspan="2">
偽字圖 2
</td>
<td>
後
</td>
</tr>
<tr>
<th>
第三步替換
</th>
<td>
韓
</td>
<td>
劇
</td>
<td>
奇
</td>
<td>
皇
</td>
<td>
后
</td>
<td>
播
</td>
<td>
出
</td>
<td>
後
</td>
</tr>
</table>
<ul>
<li>第一步替換（多對一替換）將簡體詞語「<span lang="zh-CN">韩剧</span>」、「<span lang="zh-CN">皇后</span>」、「<span lang="zh-CN">播出</span>」分別替換為三個偽字圖。</li>
<li>第二步替換（一對一替換）將不成詞的單字「<span lang="zh-CN">后</span>」替換為繁體字「後」，簡繁同形的「奇」保持不變。</li>
<li>第三步替換（一對多替換）將三個偽字圖替換為對應的繁體詞語「韓劇」、「皇后」、「播出」。</li>
</ul>
<p>注意「皇后」、「播出」是繁簡同形的詞語，但仍要在第一步替換為偽字圖，否則會影響第二步替換。</p>
<p>經過簡單的試驗可以得出，OpenType 字型在執行第一步替換時遵循「正向最大匹配」原則，與 OpenCC 的簡繁轉換演算法相同，因此二者是等效的。</p>
<h1 id="侷限性">侷限性</h1>
<h2 id="句子本身存在歧義">句子本身存在歧義</h2>
<p>簡轉繁不可能做到完全準確。例如「<span lang="zh-CN">时间不准差一分钟</span>」這個句子本身存在歧義，對應的繁體既可能是「時間不準差一分鐘」（不準確），也可能是「時間不准差一分鐘」（不允許）。</p>
<h2 id="opencc-簡繁轉換演算法的侷限性">OpenCC 簡繁轉換演算法的侷限性</h2>
<p>「正向最大匹配」演算法存在一定的侷限性。例如，對句子「<span lang="zh-CN">拥有 116 年历史</span>」執行正向最大匹配，當匹配到「<span lang="zh-CN">年</span>」時，由於「<span lang="zh-CN">年历</span>」是一個詞，會被匹配，從而錯誤地轉換為「<del style="text-decoration: none;">擁有 116 年曆史</del>」；正確的寫法應為「擁有 116 年歷史」。</p>
<h2 id="opencc-詞庫的侷限性">OpenCC 詞庫的侷限性</h2>
<p>OpenCC 詞庫不可能囊括所有詞語，例如新詞未必能及時收錄於 OpenCC 詞庫中。</p>
<h2 id="opentype-字型的侷限性">OpenType 字型的侷限性</h2>
<p>在上述方法中，一條簡繁詞語的對應關係需要使用一個偽字圖，而偽字圖也會佔據字圖數量。OpenType 字型的字圖數量上限為 65535 個。</p>
<p>為了防止字圖數量超過上限，可以採取兩種方法：</p>
<p>第一：可以從字型中刪除一些生僻字的字圖。</p>
<p>第二：可以適當刪除一些簡繁詞語的對應關係。應優先刪除繁簡同形、且在逐字轉換時不會產生錯誤的詞語，例如上面例子中的「播出」。</p>
<h1 id="功能擴展">功能擴展</h1>
<h2 id="opentype-字型的-trad-特性">OpenType 字型的 trad 特性</h2>
<p>OpenType 字型提供了 trad 特性。在排版引擎中開啟 trad 特性時，字型可以將簡體字顯示為對應的繁體字。但是，目前支援 trad 特性的字型並不多。</p>
<p>只要將上述替換表放入字型的 trad 表中，就可以製作支援 trad 特性、且能處理「一簡對多繁」的字型。</p>
<h2 id="地區字詞轉換">地區字詞轉換</h2>
<p>OpenCC 支援中國大陸、台灣、香港的習慣用字和用詞轉換。如果在上述簡繁詞語的對應關係中加入地區字詞的對應關係，就可以處理不同地區的字詞轉換，例如將「<span lang="zh-CN">内存</span>」轉換為「<span lang="zh-TW">記憶體</span>」。</p>
<p>另外，OpenType 字型可以根據語言指定不同的替換表。只要根據 OpenCC 詞庫，在 <code>ZHS</code>, <code>ZHT</code>, <code>ZHH</code> 表中指定不同的替換表，就可以令同一字型在不同語言環境下使用不同的字詞轉換。</p>
<h1 id="字型下載">字型下載</h1>
<p>根據上述方法制作了簡轉繁字型<a href="https://github.com/ayaka14732/FanWunMing">繁媛明朝</a>。</p>
<p>（作於 2020 年 7 月 31 日，修改於 2020 年 10 月 1 日）</p>
</body>
</html>
